{% load static %}

<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>J-GET CRM</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />

    <!-- Основные стили -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}" />
    <link rel="stylesheet" href="{% static 'css/buttons.css' %}" />
    <link rel="stylesheet" href="{% static 'css/tables.css' %}" />
    <link rel="stylesheet" href="{% static 'css/forms.css' %}" />
    <link rel="stylesheet" href="{% static 'css/cards.css' %}" />

    <!-- Дополнительные стили -->
    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container navbar-container">
        <a class="navbar-brand" href="/">J-GET CRM</a>

        <div class="navbar-buttons">
          {% if user.is_authenticated %}
          <span class="text-light d-flex align-items-center me-3">
            Привет, {{ user.username }} ({{ user.get_role_display }})
          </span>

          <!-- Кнопка сообщить об ошибке для всех -->
          <a href="{% url 'create_ticket' %}" class="btn btn-primary me-2">
            <i class="bi bi-bug"></i> Сообщить об ошибке
          </a>

          <!-- Ссылка на мои обращения для всех пользователей -->
          <a href="{% url 'my_tickets' %}" class="btn btn-outline-light me-2">
            Мои обращения
          </a>
          <!-- Ссылка на список тикетов ТОЛЬКО для менеджера с счетчиком -->
          {% if user.role == "manager" %} {% if open_tickets_count > 0 %}
          <a
            href="{% url 'ticket_list' %}"
            class="btn btn-danger position-relative me-2"
          >
            Тикеты
            <span
              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            >
              {{ open_tickets_count }}
            </span>
          </a>
          {% else %}
          <a href="{% url 'ticket_list' %}" class="btn btn-outline-light me-2">
            Тикеты
          </a>
          {% endif %} {% endif %}
          <a href="{% url 'dashboard' %}" class="btn btn-secondary"
            >На главную</a
          >
          {% endif %} {% if user.is_authenticated and user.role in "manager" %}
          <a href="/admin/" class="btn btn-secondary">Админ панель</a>
          {% endif %} {% if user.is_authenticated %}
          <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-light">Выйти</button>
          </form>
          {% endif %}
        </div>
      </div>
    </nav>

    <div class="container mt-4">{% block content %} {% endblock %}</div>

    <!-- Toast для уведомлений -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div
        id="liveToast"
        class="toast"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="toast-header">
          <strong class="me-auto">Уведомление</strong>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body"></div>
      </div>
    </div>

    <!-- Общие утилиты -->
    <script src="{% static 'js/utils.js' %}"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Базовые скрипты -->
    <script src="{% static 'js/base.js' %}"></script>

    <!-- Дополнительные скрипты -->
    {% block extra_scripts %}
    <script src="{% static 'js/schedule_calendar.js' %}"></script>
    {# тут может быть твой getCookie #} {% endblock %}
  </body>
</html>
