{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tables.css' %}">
<link rel="stylesheet" href="{% static 'css/forms.css' %}">
<link rel="stylesheet" href="{% static 'css/schedule_detail.css' %}">
<style>
.expense-table {
  width: 100%;
  margin-bottom: 1rem;
  background-color: transparent;
  border-collapse: collapse;
}

.expense-table th,
.expense-table td {
  padding: 0.75rem;
  vertical-align: top;
  border-top: 1px solid #dee2e6;
}

.expense-table thead th {
  vertical-align: bottom;
  border-bottom: 2px solid #dee2e6;
  background-color: #f8f9fa;
  font-weight: 600;
}

.expense-table tbody tr:hover {
  background-color: rgba(0, 0, 0, 0.075);
  cursor: pointer;
}

.clickable-expense-row {
  transition: all 0.3s ease;
}

.clickable-expense-row:hover {
  background-color: #f1f3f5;
  transform: translateX(3px);
}

/* Стили для порядковых номеров */
#expenses-table-body td:first-child {
  width: 50px;
  text-align: center;
  font-weight: 600;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <a href="{% url 'dashboard' %}" class="btn btn-secondary mb-3">
    &larr; Назад на главную
  </a>

  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <div class="d-flex justify-content-between align-items-center">
        <h3 class="mb-0">Управление расходами</h3>
        <button type="button" class="btn btn-light" id="add-expense-btn">
          <i class="bi bi-plus-lg"></i> Добавить расход
        </button>
      </div>
    </div>

    <div class="card-body">
      <div class="table-responsive">
        <table class="table expense-table">
          <thead>
            <tr>
              <th>№</th>
              <th>Смена</th>
              <th>Категория</th>
              <th>Комментарий</th>
              <th>Сумма (руб.)</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody id="expenses-table-body">
            {% for expense in expenses %}
            <tr data-expense-id="{{ expense.id }}" class="clickable-expense-row">
              <td>{{ forloop.counter }}</td>
              <td>{{ expense.schedule.name }} ({{ expense.schedule.start_date }} - {{ expense.schedule.end_date }})</td>
              <td>{{ expense.get_category_display }}</td>
              <td>{{ expense.comment }}</td>
              <td>{{ expense.amount }}</td>
              <td>
                <button class="btn p-0 border-0 bg-transparent icon-btn delete-expense-btn"
                        data-expense-id="{{ expense.id }}">
                  <i class="bi bi-trash text-danger fs-5"></i>
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="total-summary-row">
              <td colspan="4" class="text-end"><strong>Итого:</strong></td>
              <td class="text-center"><strong>{{ total_amount }}</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно для формы расхода -->
<div class="modal fade" id="expenseModal" tabindex="-1" aria-labelledby="expenseModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content" id="expense-modal-content">
      <!-- Сюда будет загружаться форма -->
    </div>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
  // Глобальные переменные
  const CSRF_TOKEN = "{{ csrf_token }}";
</script>
<script src="{% static 'js/expense_list.js' %}"></script>
{% endblock %}